if exists (select 1 from dbo.sysobjects where id = object_id(N'[dbo].[UspGNOVACompassClntCode]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
     drop procedure [dbo].[UspGNOVACompassClntCode]
GO

CREATE PROCEDURE [dbo].[UspGNOVACompassClntCode]
AS
BEGIN
 
	SET NOCOUNT ON
	BEGIN TRAN	
	DECLARE @tempSysGenNum decimal(9,0)
	
	SELECT @tempSysGenNum = 100000 + SYSGENNUM FROM TSYSGENNUM WHERE TBLCODE = 'CL' AND RCDSTS = 'A'
	
	while exists(SELECT 1 FROM TCLIENT WHERE CLNTCODE = right(cast(@tempSysGenNum  as varchar(6)),5))
	begin
	   set @tempSysGenNum = @tempSysGenNum + 1
	end
	

	update TSYSGENNUM set SYSGENNUM = right(@tempSysGenNum+1,5) WHERE TBLCODE = 'CL' AND RCDSTS = 'A'
	
	INSERT TCLIENT(CLNTCODE,CLNTNAME,ADDRESS1,ADDRESS2,ADDRESS3,STATE,CNTYCODE,MAILCODE,TELNO,FAXNO,CONTPERSON,CONTITLE,SALARYMODE,SALARYCURC,SICCODE,PARENTCOMP,STATUS,STATEFFDT,DOCSEQ,GENCERTIND,GENCERTNUM,SUBOFFIND,PREMTAXIND,GENOSPRMNT,RCDSTS,RCDUSRID,RCDDTSTMP,BILLSEQNUM,ADDRESS4,EMAILADDR,BankCode,BankAC,TaxID,PAYEENAME,CLNTNAMEGEN,PRMRFBANKCODE,PRMRFBANKACCT,BANKBRNAME,PRMRFBANKBRNAME,DNBcode,AIGCLNTCODE,DISTRICT,CITY,CRITTYPE,CRITCODE,COMPNATURE,INDUSTRYCLS,NOOFMEMS,EXCLUDE,OPTOUTIND) 
	VALUES(right(cast(@tempSysGenNum  as varchar(6)),5),N'NOVA Pending',N'XXXXXX',N'',N'',N'',N'061',N'',N'',N'',N'XXX',N'',N'X',N'086',N'99X',N'',N'A',N'1900-01-01',0,N'Y',0,N'Y',N'Y',N'Y',N'A',N'NCOP888','1900-01-01',0,N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',N'',NULL,N'',N'')


	select right(cast(@tempSysGenNum  as varchar(6)),5) as SYSGENNUM



	COMMIT

END
