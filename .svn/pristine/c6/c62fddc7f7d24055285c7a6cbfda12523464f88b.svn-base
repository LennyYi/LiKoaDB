IF EXISTS (SELECT * FROM SYSOBJECTS WHERE ID = OBJECT_ID('dbo.USPGNOVABENAMTMB') AND sysstat & 0xf = 4)
      drop procedure dbo.USPGNOVABENAMTMB
GO

SET ANSI_NULLS ON 
SET QUOTED_IDENTIFIER ON  
SET CONCAT_NULL_YIELDS_NULL ON 
SET ANSI_WARNINGS ON 
SET ANSI_PADDING ON
GO
CREATE PROCEDURE dbo.USPGNOVABENAMTMB
(@request_no            VARCHAR(30))
AS
BEGIN
/*error handling variable section */
DECLARE @ErrFrom  CHAR(20)
DECLARE @ErrMsg         CHAR(65)
DECLARE @ErrData  CHAR(45)
DECLARE @ErrCode        INT
DECLARE @StoreProcInd   CHAR(1)
DECLARE     @cMSGID           CHAR(5)
/*DECLARE VARIABLES AND CONSTANTS*/
DECLARE     @cACTIVE    CHAR(1)
DECLARE     @cDELETED   CHAR(1)
DECLARE     @cYES       CHAR(1)
DECLARE     @cNO        CHAR(1)
DECLARE @XML XML 
DECLARE     @CLNTCODE   CHAR(1)
DECLARE     @cCLNTCODE  CHAR(5)
DECLARE     @cPOLNO           CHAR(10)
DECLARE @cProgramID VARCHAR(60)

SELECT @cACTIVE = 'A'


SELECT @XML = NovaXML FROM T_Nova_TXMLConvert where request_no = @request_no
SELECT  @cCLNTCODE = T.N.value('CLNTCODE[1]','varchar(20)') from  @XML.nodes('/form/TCLIENT/item') T(N) 
SELECT  @cPOLNO = T.N.value('POLNO[1]','varchar(10)') from  @XML.nodes('/form/TPOLICY/item') T(N) 

update T2 
set    LIMITENTITLED = BENAMTMB
FROM   TPOLPDTBEN T1, TPOLPDTLIMIT T2
where  T1.POLNO      = T2.POLNO
and    T1.PRODCODE   = T2.PRODCODE
and    T1.PRODCODE   = '211S5'
and    T1.BENPLNCD   = T2.BENPLNCD
and    T2.LIMITNUMBER in ('123', '4022')
and    T1.POLNO      = @cPOLNO


update T2 
set    LIMITENTITLED = DEDUCTBEN
FROM   TPOLPDTBEN T1, TPOLPDTLIMIT T2
where  T1.POLNO      = T2.POLNO
and    T1.PRODCODE   = T2.PRODCODE
and    T1.PRODCODE   = '211S5'
and    T1.BENPLNCD   = T2.BENPLNCD
and    T2.LIMITNUMBER in ('4490', '4491')
and    T1.POLNO      = @cPOLNO



END

SET ANSI_NULLS OFF 
SET QUOTED_IDENTIFIER OFF  
SET CONCAT_NULL_YIELDS_NULL OFF 
SET ANSI_WARNINGS OFF 
SET ANSI_PADDING OFF 
GO
